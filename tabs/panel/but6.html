<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ Instagram</title>
  <style>
    .fly-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 10px;
      box-sizing: border-box;
      max-width: 300px;
      margin: 0 auto;
      border-radius: 8px;
      color: white;
      font-family: Arial, sans-serif;
    }

    #fly-special-block {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .fly-img {
      width: 80px;
      height: 80px;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
    }

    #unique-text {
      font-size: 24px;
      font-weight: bold;
      color: #ffffff;
    }

    #fly-foot {
      font-size: 14px;
      color: white;
      text-align: center;
      margin-bottom: 15px;
    }

    a:link,
    a:visited {
      color: #00D6CA;
      text-decoration: none;
    }

    .button-container {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    #check-instagram-subscription {
      width: 250px;
      height: 50px;
      border-radius: 8px;
      background-color: #00D6CA;
      color: black;
      font-size: 18px;
      font-weight: 800;
      box-shadow: 0 0 10px rgba(0, 214, 202, 0.5);
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease;
    }

    #check-instagram-subscription:hover {
      background-color: #00b3a0;
    }

    #check-instagram-subscription:active {
      background-color: #009d8b;
    }
  </style>
</head>
<body>
<div class="fly-container">
  <article id="fly-special-block">
    <img src="/dorwey/image/Instagram_result.webp" alt="Instagram Icon" class="fly-img"/>
  </article>

  <div class="container">
    <span id="unique-text">ü™ô +300</span>
  </div>

  <div id="fly-foot">
    –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ Instagram:
    <a href="https://www.instagram.com/_dslash1990_/" id="instagram-link" target="_blank">@_dslash1990_</a>
  </div>

  <div id="button-container" class="button-container">
    <button id="check-instagram-subscription">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
  </div>
</div>

<script>
  if (window.Telegram && window.Telegram.WebApp) {
    let userId;

    try {
      userId = window.Telegram.WebApp.initDataUnsafe.user.id;
    } catch (error) {
      console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å userId:', error);
      userId = null;
    }

    if (!userId) {
      alert('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Telegram WebApp.');
    } else {
      const instagramLink = 'https://www.instagram.com/_dslash1990_/';

      const checkInstagramSubscriptionStatus = async () => {
        try {
          console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ Instagram...');

          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å userId
          const response = await fetch('https://gorskyapp.ru/api/check-instagram-subscription', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: userId }),
          });

          console.log('HTTP-—Å—Ç–∞—Ç—É—Å:', response.status);

          let data;
          try {
            data = await response.json();
            console.log('–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', error);
            alert('–û—à–∏–±–∫–∞: —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç.');
            return;
          }

          if (!response.ok) {
            alert(data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.');
            return;
          }

          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
          switch (data.message) {
            case 'Timer started. Please subscribe and come back.':
              alert('–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–±—è –≤ Instagram!');
              window.open(instagramLink, '_blank');
              break;

            case 'Checking subscription. Please wait.':
              alert('–ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏.');
              break;

            case '300 points credited for Instagram subscription.':
              alert('–¢–µ–±–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ 300 –ï–∂–ö–æ–∏–Ω–æ–≤ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É!');
              break;

            case 'Points already credited for Instagram subscription.':
              alert('–¢—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª –±–æ–Ω—É—Å –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ Instagram!');
              break;

            case 'Subscribed to instagram and 300 points credited':
              alert('–¢–µ–±–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã 300 –ï–∂–ö–æ–∏–Ω–æ–≤ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ Instagram!');
              break;

            case 'Already subscribed to instagram':
              alert('–¢—ã —É–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ Instagram.');
              break;

            default:
              console.warn('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data.message);
              alert('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.');
          }
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ:', error);
          alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.');
        }
      };

      document.getElementById('check-instagram-subscription').addEventListener('click', checkInstagramSubscriptionStatus);
    }
  }
</script>
</body>
</html>
