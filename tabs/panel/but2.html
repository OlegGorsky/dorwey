<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ YouTube</title>
  <style>
    .fly-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 10px;
      box-sizing: border-box;
      max-width: 300px;
      margin: 0 auto;
      border-radius: 8px;
      color: white;
      font-family: Arial, sans-serif;
    }
    
    #fly-special-block {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .fly-img {
      width: 80px;
      height: 80px;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
    }
    
    #unique-text {
      font-size: 24px;
      font-weight: bold;
      color: #ffffff;
    }
    
    #fly-foot {
      font-size: 14px;
      color: white;
      text-align: center;
      margin-bottom: 15px;
    }
    
    a:link,
    a:visited {
      color: #00D6CA;
      text-decoration: none;
    }
    
    .button-container {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    
    #check-youtube-subscription {
      width: 250px;
      height: 50px;
      border-radius: 8px;
      background-color: #00D6CA;
      color: black;
      font-size: 18px;
      font-weight: 800;
      box-shadow: 0 0 10px rgba(0, 214, 202, 0.5);
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease;
    }
    
    #check-youtube-subscription:hover {
      background-color: #00b3a0;
    }
    
    #check-youtube-subscription:active {
      background-color: #009d8b;
    }
  </style>
</head>
<body>
<div class="fly-container">
  <article id="fly-special-block">
    <img src="https://files.salebot.pro/uploads/file_item/file/44501/Youtube.png" alt="YouTube Icon" class="fly-img"/>
  </article>

  <div class="container">
    <span id="unique-text">ü™ô +300</span>
  </div>

  <div id="fly-foot">
    –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ YouTube –∫–∞–Ω–∞–ª:
    <a href="https://www.youtube.com/@hedgehogmoney" id="youtube-link" target="_blank">–ï–∂ –ø—Ä–æ –¥–µ–Ω—å–≥–∏ ü¶î</a>
  </div>

  <div id="button-container" class="button-container">
    <button id="check-youtube-subscription">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
  </div>
</div>

<script>
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ Telegram WebApp API
  if (window.Telegram && window.Telegram.WebApp) {
    let userId;

    try {
      userId = window.Telegram.WebApp.initDataUnsafe.user.id;
    } catch (error) {
      console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å userId:', error);
      userId = null;
    }

    // –ï—Å–ª–∏ userId –Ω–µ –ø–æ–ª—É—á–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    if (!userId) {
      console.error('userId –Ω–µ –±—ã–ª –ø–æ–ª—É—á–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ Telegram WebApp.');
      alert('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Telegram WebApp.');
    } else {
      const youtubeLink = 'https://www.youtube.com/@hedgehogmoney';

      const checkYoutubeSubscriptionStatus = async () => {
        try {
          console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏...');

          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å userId
          const response = await fetch('https://gorskyapp.ru/api/check-youtube-subscription', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ userId: userId }) // –ü–µ—Ä–µ–¥–∞—ë–º userId –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
          });

          // –õ–æ–≥–∏—Ä—É–µ–º –≤–µ—Å—å –æ—Ç–≤–µ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          console.log('HTTP-—Å—Ç–∞—Ç—É—Å:', response.status);
          console.log('–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response);

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –æ—Ç–≤–µ—Ç –±—ã—Ç—å JSON
          let data;
          try {
            data = await response.json();
            console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (JSON):', data);
          } catch (jsonError) {
            console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', jsonError);
            alert('–û—à–∏–±–∫–∞: —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç.');
            return;
          }

          // –ï—Å–ª–∏ HTTP-—Å—Ç–∞—Ç—É—Å –Ω–µ OK
          if (!response.ok) {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
            alert(data.message || '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –ø–æ–∑–∂–µ.');
            return;
          }

          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
          switch (data.message) {
            case 'Timer started. Please subscribe and come back.':
              alert('–ü—Ä–æ–≤–µ—Ä—è—é —Ç–≤–æ—é –ø–æ–¥–ø–∏—Å–∫—É! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–±—è –Ω–∞ YouTube.');
              window.open(youtubeLink, '_blank'); // –û—Ç–∫—Ä—ã–≤–∞–µ–º YouTube
              break;

            case 'Checking subscription. Please wait.':
              alert('–ü—Ä–æ–≤–µ—Ä—è—é —Ç–≤–æ—é –ø–æ–¥–ø–∏—Å–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏!');
              break;

            case '300 points credited for YouTube subscription.':
              alert('–û—Ç–ª–∏—á–Ω–æ! –¢–µ–±–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ 300 –ï–∂–ö–æ–∏–Ω–æ–≤ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É!');
              break;

            case 'Points already credited for YouTube subscription.':
              alert('–¢–µ–±–µ —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω–æ 300 –ï–∂–ö–æ–∏–Ω–æ–≤ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É!');
              break;

            case 'Already subscribed to youtube':
              alert('–í—ã —É–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ YouTube. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—Ä—É–≥–∏–µ –±–æ–Ω—É—Å—ã!');
              break;

            default:
              alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞ –ø–æ–∑–∂–µ.');
          }
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏:', error);
          alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞ –ø–æ–∑–∂–µ.');
        }
      };

      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É
      document.getElementById('check-youtube-subscription').addEventListener('click', checkYoutubeSubscriptionStatus);
    }
  } else {
    console.error('Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Telegram WebApp.');
    alert('–û—à–∏–±–∫–∞: Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –≤ Telegram.');
  }
</script>
</body>
</html>
